(function(b,a){if(typeof module!=="undefined"&&module){module.exports=a();return}b.MiniPromise=a()}(this||window,function(){var c=0,e=1,d=2;var b=0;function a(g){this.id=b++;this.status=c;this.userToken=null;this.exception=null;this._then=null;this._catch=null;this._finally=null;this._next=null;if(!g){return}var f=this;g(function(h){f.resolve(h)},function(h){f.reject(h)})}a.prototype.__checkCatch=function(f){if(this._next){this._next.__checkCatch(f);return}try{if(this._catch){this._catch(f);return}throw f}finally{this._finally&&this._finally()}};a.prototype.reject=function(g){this.exception=g;this.status=d;var f=this;setTimeout(function(){f.__checkCatch(g)},0)};a.prototype.resolve=function(g){this.userToken=g;this.status=e;var f=this;setTimeout(function(){if(!f._then){f._finally&&f._finally();return}try{var i=f._then(g);if(i instanceof a){i.then(function(j){f._next.resolve(j)}).catch(function(j){f._next.reject(j)});return}f._next.resolve(i)}catch(h){f._next.reject(h)}},0)};a.prototype.then=function(f){if(this.status===e){try{var h=f(this.userToken);if(h instanceof a){return this._next=h}return this._next=a.resolve(h)}catch(g){return this._next=a.reject(g)}}if(this.status===d){return this._next=new a()}this._then=f;return this._next=new a()};a.prototype.catch=function(f){this._catch=f;return this};a.prototype.finally=function(f){this._finally=f};a.resolve=function(f){return new a(function(h,g){h(f)})};a.reject=function(f){return new a(function(h,g){g(f)})};a.all=function(f){var g=[];if(f instanceof Array){g=f}else{g=Array.prototype.slice.call(arguments,0)}return new a(function(m,l){var o=[];var h=[];var j=0;function n(){j++;if(j===g.length){if(h.length>0){l(h)}else{m(o)}}}for(var k=0;k<g.length;k++){(function(q,i){q.then(function(p){o[i]=p;n()}).catch(function(p){h[i]=p;n()})})(g[k],k)}})};return a}));